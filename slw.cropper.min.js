(function(l){l.fn.slwCropper=l.fn.jqcropper=function(f){f=l.extend({aspectRatio:1.8,preview:null,fileInput:!0,pos:null,autoFit:.8,userListener:null},f);var C=!1,D=!1,N=!0,E=l(document),q=l(this),t=q.attr("src"),x=q.parent(),O=x.parent(),g=l('\x3cdiv class\x3d"cropper-container"\x3e\x3c/div\x3e'),r=l('\x3cdiv class\x3d"cropper-dragger"\x3e\x3c/div\x3e'),y=document.createElement("img"),v={},a={},k={},p={},n={},u={},P=f.preview,m="",w,F,G=null,H,A,I,z={getNaturalPos:function(){return k},getPreviewPos:function(){p.width=q.width();p.height=q.height();p.x=0;p.y=0;return p},getCropPos:function(){B();return n},setCropPos:function(c){n=c;c=p.width/k.width;k.height>k.width&&(c=p.height/k.height);a=J(c,n);Q()},getCropPosData:function(){B();F.clearRect(0,0,w.width,w.height);w.width=n.width;w.height=n.height;F.drawImage(q[0],n.x,n.y,n.width,n.height,0,0,n.width,n.height);return w.toDataURL("image/png")},setUrl:function(a){Slw.Utils.isnull(a)||(t=a,q.attr("src",t),q.show(),R(S))},getFile:function(){return G},getPos:function(){return a},setPos:function(c){a=c;B();Q()}},K=function(){return f.fileInput&&!(Slw.Utils.isIE()&&10>Slw.Utils.ieVersion())},B=function(){var c=k.width/p.width;k.height>k.width&&(c=k.height/p.height);n=J(c,a)},J=function(a,e){return{x:Math.round(a*e.x),y:Math.round(a*e.y),width:Math.round(a*e.width),height:Math.round(a*e.height)}},L=function(a){var c=a.originalEvent?a.originalEvent.pageX:a.pageX,b=a.originalEvent?a.originalEvent.pageY:a.pageY;Slw.Utils.isIE()&&9>Slw.Utils.ieVersion()&&(c=a.pageX,b=a.pageY);return{x:c,y:b}},h=function(a){return Slw.Utils.isNumber(a)?a+"px":a},M=function(){r.css({left:h(a.x),top:h(a.y),width:h(a.width),height:h(a.height)});r.find("img").css({"margin-left":"-"+h(a.x),"margin-top":"-"+h(a.y)});Z();Slw.Utils.isnull(f.userListener)||(B(),f.userListener(n))},R=function(a){Slw.Utils.isnull(t)?a():(y.onerror=function(){a()},y.onload=function(){a()},y.src=t)},T=function(c,e){c.css("height",a.height*c.width()/a.width);var b=c.width(),d=c.height(),b=b/a.width;a.height>a.width&&(b=d/a.height);d=J(b,a);e.css({width:h(Math.round(b*p.width)),height:h(Math.round(b*p.height)),"margin-left":"-"+h(d.x),"margin-top":"-"+h(d.y)})},V=function(c,e){var b=c.x-v.x,d=a.x+b;a.width+=b*(e?1:-1);e||(a.x=d);0>a.width&&(a.width=-a.width,a.x-=a.width,U(1));Slw.Utils.isnull(f.aspectRatio)||1!=m.length||(b=a.width/f.aspectRatio,a.y-=(b-a.height)/2,a.height=b,a.y+a.height>g.height()?(a.y=g.height()-a.height,0>a.y&&(a.y=0,a.height=g.height(),a.width=a.height*f.aspectRatio)):0>a.y?a.y=0:0>a.x&&(a.x=0))},W=function(c,e){var b=c.y-v.y,d=a.y+b;a.height+=b*(e?1:-1);e||(a.y=d);0>a.height&&(a.height=-a.height,a.y-=a.height,U(0));Slw.Utils.isnull(f.aspectRatio)||1!=m.length||(b=a.height*f.aspectRatio,a.x-=(b-a.width)/2,a.width=b,a.x+a.width>g.width()?(a.x=g.width()-a.width,0>a.x&&(a.x=0,a.width=g.width(),a.height=a.width/f.aspectRatio)):0>a.x?a.x=0:0>a.y&&(a.y=0))},U=function(a){if(1==m.length)m=u[m][0];else{var c=[];c[0]=m.substring(0,1);c[1]=m.substring(1,2);c[a]=u[c[a]][0];m=c[0]+c[1]}},Q=function(){0<=a.x&&0<=a.y&&0<a.width&&0<a.height&&a.x+a.width<=g.width()&&a.y+a.height<=g.height()?M():X()},Y=function(){g.on("mousemove touchmove",function(c){c.preventDefault();a:{c=L(c);if(D){for(var e=[],b=0;b<m.length;b++)e[b]=m.substring(b,b+1),u[e[b]][1](c,u[e[b]][2]);var d;if(!Slw.Utils.isNumber(a.x)||0>a.x)a.x=0;if(!Slw.Utils.isNumber(a.y)||0>a.y)a.y=0;Slw.Utils.isnull(f.aspectRatio)||2!=m.length||("ne"==m?(d=a.height*f.aspectRatio,d+a.x>g.width()?(a.width=g.width()-a.x,d=a.width/f.aspectRatio,a.y+=a.height-d,a.height=d):a.width=d):"nw"==m?0>a.x?(a.width+=a.x,a.x=0,a.y-=d):(d=a.width/f.aspectRatio,a.y+=a.height-d,a.height=d):"se"==m?a.height+a.y>g.height()?(a.height=g.height()-a.y,a.width=a.height*f.aspectRatio):a.height=a.width/f.aspectRatio:"sw"==m&&(a.height+a.y>g.height()?(a.height=g.height()-a.y,d=a.height*f.aspectRatio,a.x+=a.width-d,a.width=d):a.height=a.width/f.aspectRatio))}else if(C)d=a.x+(c.x-v.x),e=a.y+(c.y-v.y),0>d?a.x=0:d+a.width>g.width()?a.x=g.width()-a.width:a.x=d,0>e?a.y=0:e+a.height>g.height()?a.y=g.height()-a.height:a.y=e;else break a;M();v=c}});E.on("mouseup.jqcropper",function(a){a.preventDefault();D=C=!1;E.unbind("mouseup.jqcropper");g.unbind()})},aa=function(){E.unbind("mouseup.jqcropper");g.unbind();r.unbind();H.unbind();K()&&(A.unbind(),I.unbind());K()&&(A.on("change",function(a){a=a.target.files;Slw.Utils.isIE()&&10>Slw.Utils.ieVersion()?(a=this.value,z.setUrl(a)):0<a.length&&(G=a[0],a=URL.createObjectURL(G),z.setUrl(a));l(this).val("")}),I.click(function(){A.click()}));H.on("mousedown touchstart",function(a){a.preventDefault();D=!0;Y();v=L(a);m=l(this).attr("data-dir")});r.on("mousedown touchstart",function(a){a.preventDefault();C=!0;Y();v=L(a)})},ba=function(){P.each(function(){var a=Slw.Utils.isnull(t)?"":'" src\x3d"'+t+'"',a=l("\x3cimg "+a+' style\x3d"min-width: 0px !important; min-height: 0px !important; max-width: none !important; max-height: none !important;"\x3e');l(this).html("");l(this).append(a);T(l(this),a)})},Z=function(){P.each(function(){var a=l(this).find("img");T(l(this),a)})},X=function(){var c=g.width(),e=g.height(),b=f.aspectRatio;Slw.Utils.isnull(b)&&(b=c/e);1<b?(a.width=c*f.autoFit,a.height=a.width/b,a.height>e&&(a.height=e*f.autoFit,a.width=a.height*b)):(a.height=e*f.autoFit,a.width=a.height*b,a.width>c&&(a.width=c*f.autoFit,a.height=a.width/b));a.x=(c-a.width)/2;a.y=(e-a.height)/2;M()},S=function(){r.find(".cropper-viewer img").attr("src",t);k.x=0;k.y=0;k.width=y.width;k.height=y.height;var a=x.width(),e=x.height(),b=a,d=a*k.height/k.width;d>e?(d=e,b=e*k.width/k.height,g.css({width:h(b),height:h(d),left:h((a-b)/2),top:h(0)})):g.css({width:h(b),height:h(d),left:h(0),top:h((e-d)/2)});q.css({width:h(b),height:h(d)});r.find(".cropper-viewer img").css({width:h(b),height:h(d)});z.getPreviewPos();N&&!Slw.Utils.isnull(f.pos)?(N=!1,z.setCropPos(f.pos)):X();ba();aa()};Slw.Utils.isnull(t)&&(q=l('\x3cimg style\x3d"display:none;" /\x3e'));K()&&(x.before('\x3cdiv class\x3d"crop-upload"\x3e\t\x3cbutton type\x3d"button" class\x3d"btn btn-primary crop-file"\x3e\t\t\x3ci class\x3d"fa fa-folder-open-o"\x3e \u8bf7\u9009\u62e9\u56fe\u7247\x3c/i\x3e\t\x3c/button\x3e\t\x3cinput type\x3d"file" class\x3d"crop-input" accept\x3d"image/jpg,image/jpeg,image/png,image/gif" name\x3d"crop_file" style\x3d"display: none"\x3e\x3c/div\x3e'),A=O.find(".crop-input"),I=O.find(".crop-file"));x.empty().append(g);r.append('\x3ccanvas id\x3d"cropCanvas" style\x3d"display:none;" /\x3e\x3cspan class\x3d"cropper-viewer"\x3e\x3cimg /\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-h"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-v"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-face" data-dir\x3d"all"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-e" data-dir\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-n" data-dir\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-w" data-dir\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-s" data-dir\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-e" data-dir\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-n" data-dir\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-w" data-dir\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-s" data-dir\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-ne" data-dir\x3d"ne"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-nw" data-dir\x3d"nw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-sw" data-dir\x3d"sw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-se" data-dir\x3d"se"\x3e\x3c/span\x3e');g.append(q).append('\x3cdiv class\x3d"cropper-canvas cropper-modal cropper-crop"\x3e\x3c/div\x3e').append(r);try{w=r.find("#cropCanvas")[0],F=w.getContext("2d")}catch(c){}H=r.find(".cropper-line, .cropper-point");u.e=["w",V,!0];u.w=["e",V,!1];u.s=["n",W,!0];u.n=["s",W,!1];R(S);return z}})(jQuery);